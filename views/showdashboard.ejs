<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        /* body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: #F1FAFF;
        } */

        .container {
            height: 100%;
            /* width: 50%; */
            /* margin: auto; */
            padding: 10px;
            border: 2px solid black;
            /* background-color: #F1FAFF; */
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* padding: 20px 0; */
            background: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin: 0;
        }

        header .buttons {
            display: flex;
            gap: 10px;
        }

        header .btn {
            display: flex;
            align-items: center;
            padding: 15px 17px;
            gap: 3px;
           
            height: 41.82px;
            background: #20C997;
            box-shadow: 0px 2px 3px rgba(0, 0, 0, 0.25);
            border-radius: 28.75px;
            border: none;
            color: #fff;
            text-align: center;
            cursor: pointer;
        }

        header .btn:hover {
            background: #31b0d5;
        }

        .stats-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .stat-item {
            padding: 20px;
            flex: 1 1 calc(20% - 10px);
            border-radius: 10px;
            text-align: center;
            color: #333;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        #total-screens {
            background-color: #b3d1ff;
        }

        #online-screens {
            background-color: #b3ffb3;
        }

        #offline-screens {
            background-color: #ffb3b3;
        }

        #total-media-files {
            background-color: #ffffb3;
        }

        #storage-used {
            background-color: #e6e6e6;
        }

        .stat-item p {
            margin: 0;
            font-size: 18px;
        }

        .stat-item h2 {
            margin: 10px 0 0;
            font-size: 36px;
        }

        .main-content {
            display: flex;
            /* flex-wrap: wrap; */
            justify-content: center;
            width: 100%;
            align-items: center;
            gap: 15px;
            /* margin-top: 20px; */
        }

        .screens, .map{
            flex: 1 1 50%;
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* .screens h2, .map h2, .activity-log h2 {
            margin-top: 0;
        } */

        .screens table {
            width: 100%;
            border-collapse: collapse;
            height: 350px;
        }

        .screens table, .screens th, .screens td {
            border: 1px solid #ddd;
        }

        .screens th, .screens td {
            padding: 8px;
            text-align: left;
        }

        .screens .details-btn {
            padding: 5px 10px;
            border: none;
            background: #5bc0de;
            color: #fff;
            cursor: pointer;
        }

        .screens .details-btn:hover {
            background: #31b0d5;
        }

      

        .view-more-btn {
            display: block;
            margin: 20px auto 0;
            padding: 10px 20px;
            border: none;
            background: #5bc0de;
            color: #fff;
            cursor: pointer;
            text-align: center;
        }

        .view-more-btn:hover {
            background: #31b0d5;
        }

        .map iframe {
            width: 100%;
            height: 350px;
            border: 0;
            border-radius: 5px;
        }
    </style>
  
</head>
<body>
    <%- include('Dashboard') %>
    <div class="container">
        <header>
            <h1>Dashboard</h1>
            <div class="buttons">
                <button class="btn">New Screen</button>
                <button class="btn">New Playlist</button>
                <button class="btn">New Group</button>
                <button class="btn">Add Media</button>
            </div>
        </header>
       
        <div class="stats-container">
            <div class="stat-item" id="total-screens">
                <p>Total Screens</p>
                <h2><%= totalScreenCount %></h2>
            </div>
            <div class="stat-item" id="online-screens">
                <p>Online Screens</p>
                <h2><%= onlineScreenCount %></h2>
            </div>
            <div class="stat-item" id="offline-screens">
                <p>Offline Screens</p>
                <h2><%= deletedScreenCount %></h2>
            </div>
            <div class="stat-item" id="total-media-files">
                <p>Total Media Files</p>
                <h2><%= totalMediaFiles %></h2>
            </div>
            <div class="stat-item" id="storage-used">
                <p>Storage Used</p>
                <h2 id="storage-used-value">Loading...</h2>
            </div>
        </div>
        <div class="main-content">
            <div class="screens">
                <h2>Screens/Players</h2>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Screen Name</th>
                            <th>Playlist Name</th>
                            <th>Last Response</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- <tr>
                            <td>1</td>
                            <td>Orbit Mall, Lift 1</td>
                            <td>Playlist 123</td>
                            <td>2 minutes ago</td>
                            <td><button class="details-btn">Details</button></td>
                        </tr> -->
                        <!-- Repeat for other rows -->

                        <% if (allScreens && allScreens.length) { %>
                            <% allScreens.slice(0, 5).forEach((screen, index) => { %>
                              <tr>
                                <td>
                                  <%= index + 1 %>
                                </td>
                                <td id="screen.screenname">
                                    <%= screen.screenname.length > 20 ? screen.screenname.substring(0, 20) + '...' : screen.screenname %>
                                  </td>
                                <td id="screen.playlistname">
                                    <%= screen.playlistname && screen.playlistname.length> 20 ?
                                    screen.playlistname.substring(0, 20) + '...' : screen.playlistname %>
                                </td>
                                <td>
                                    minutes ago
                                  </td>
                                <td>
                                  <button class="details-btn">Details</button>
                                </td>
                              </tr>
                            <% }); %>
                          <% } %>
                          
                    </tbody>
                </table>
                <!-- <button class="view-more-btn">View More</button> -->
            </div>
            <div class="map">
                <h2>Screen Location</h2>
                <iframe src="https://www.google.com/maps/d/u/0/embed?mid=1nNDHwVxe_uS-6wStUoSXOsTyxBM1pw8&ehbc=2E312F&noprof=1"></iframe>
            </div>
        </div>
      <div class="screens">
    <h2>Activity Log</h2>
    <table>
        <thead>
            <tr>
                <th>Date</th>
              
                <th>Message</th>
               
            </tr>
        </thead>
        <tbody>
            <% logs.slice(0, 5).forEach(log => { %>
                <tr>
                    <td><%= log.createdAt %></td>
                    <td><%= log.message.length > 20 ? log.message.substring(0, 20) + '...' : log.message %></td>
                    
                </tr>
            <% }) %>
        </tbody>
    </table>
    <button class="view-more-btn">View More</button>
</div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/cloudinary-storage')
                .then(response => response.json())
                .then(data => {
                    console.log('Fetched data:', data); // Debug log
                    const storageUsedElement = document.getElementById('storage-used-value');
                    const storageUsed = data && data.storage && data.storage.usage || 0;
                    console.log('Storage used:', storageUsed); // Debug log
                    storageUsedElement.textContent = `${(storageUsed / (1024 * 1024)).toFixed(2)} mb`;
                })
                .catch(error => console.error('Error fetching storage data:', error));
        });
    </script>
</body>
</html>
